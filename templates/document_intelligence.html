<!DOCTYPE html>
<html>
<head>
    <title>Document Intelligence</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 40px;
        }

        .section {
            margin-bottom: 30px;
        }

        .box {
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 6px;
            background-color: #fafafa;
        }

        .ok {
            color: green;
            font-weight: bold;
        }

        .warn {
            color: orange;
            font-weight: bold;
        }

        .bad {
            color: red;
            font-weight: bold;
        }

        ul {
            margin-top: 10px;
        }

        .btn {
            padding: 12px 20px;
            font-size: 16px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
        }

        .btn-primary {
            background-color: #0b5ed7;
            color: white;
        }

        .btn-secondary {
            background-color: #6c757d;
            color: white;
        }
    </style>
</head>
<body>

<!-- üî∑ Pipeline Progress Bar -->
{% include "progress_bar.html" %}

<h1>üìÑ Document Intelligence</h1>

<!-- 1Ô∏è‚É£ Uploaded Documents -->
<div class="section">
    <h3>1Ô∏è‚É£ Uploaded Documents</h3>
    <div class="box">
        {% if result.document_status and result.document_status.uploaded %}
            {% for doc in result.document_status.uploaded %}
                <p class="ok">‚úî {{ doc }}</p>
            {% endfor %}
        {% else %}
            <p class="warn">‚ö† No documents uploaded</p>
        {% endif %}
    </div>
</div>

<!-- 2Ô∏è‚É£ Extracted Fields -->
{% if result.document_extraction %}
<div class="section">
    <h3>2Ô∏è‚É£ Extracted Information</h3>
    <div class="box">
        {% for doc, fields in result.document_extraction.items() %}
            <h4>{{ doc }}</h4>
            <ul>
                {% for key, value in fields.items() %}
                    <li><b>{{ key | replace("_", " ") | capitalize }}:</b> {{ value }}</li>
                {% endfor %}
            </ul>
        {% endfor %}
    </div>
</div>
{% endif %}

<!-- 3Ô∏è‚É£ Validation Results -->
{% if result.document_validation %}
<div class="section">
    <h3>3Ô∏è‚É£ Validation Results</h3>
    <div class="box">

        <!-- Expiry Check -->
        {% if result.document_validation.expired %}
            <p class="bad">‚ùå Expired Documents Detected</p>
            <ul>
                {% for doc in result.document_validation.expired %}
                    <li>{{ doc }}</li>
                {% endfor %}
            </ul>
        {% else %}
            <p class="ok">‚úî No expired documents</p>
        {% endif %}

        <!-- Name Consistency -->
        {% if result.document_validation.name_consistent %}
            <p class="ok">‚úî Supplier name is consistent across documents</p>
        {% else %}
            <p class="warn">‚ö† Supplier name mismatch detected across documents</p>
        {% endif %}

    </div>
</div>
{% endif %}

<!-- 4Ô∏è‚É£ Document Completeness Score -->
{% if result.document_score is not none %}
<div class="section">
    <h3>4Ô∏è‚É£ Document Completeness Score</h3>
    <div class="box">
        <p><b>Score:</b> {{ result.document_score }}</p>

        {% if result.document_score >= 0.8 %}
            <p class="ok">‚úî Documents are complete. Eligible for financial evaluation.</p>
        {% elif result.document_score >= 0.5 %}
            <p class="warn">‚ö† Documents require manual review.</p>
        {% else %}
            <p class="bad">‚ùå Action required. Please upload corrected documents.</p>
        {% endif %}
    </div>
</div>
{% endif %}

<hr>

<!-- üî• THIS IS THE CRITICAL ORCHESTRATION BUTTON -->
{% if result.workflow_status == "RUNNING" %}
    <form action="/financial/run" method="post">
        <button class="btn btn-primary">
            üí∞ Proceed to Financial Health Evaluation
        </button>
    </form>
{% endif %}

<br>

<a href="/">
    <button class="btn btn-secondary">
        ‚¨Ö Register Another Supplier
    </button>
</a>

</body>
</html>
